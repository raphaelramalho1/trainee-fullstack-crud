<!-- Bootstrap Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <span class="navbar-brand">Gerenciador de Tarefas</span>
    <a class="btn btn-light" routerLink="/tarefas/nova">
      â• Nova Tarefa
    </a>
  </div>
</nav>

<div class="container mt-4">
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-1">Lista de Tarefas</h5>
      <small class="text-muted">
        Total: {{ taskService.totalTasks }} | 
        Pendentes: {{ taskService.pendingTasks.length }} | 
        ConcluÃ­das: {{ taskService.completedTasks.length }}
      </small>
    </div>

    <div class="card-body">
      <div class="btn-group mb-3 d-flex justify-content-center" role="group">
        <input type="radio" class="btn-check" name="filter" id="all" value="all" 
               [checked]="taskService.filter() === 'all'" (change)="onFilterChange('all')">
        <label class="btn btn-outline-primary" for="all">
          ğŸ“‹ Todas ({{ taskService.totalTasks }})
        </label>
        
        <input type="radio" class="btn-check" name="filter" id="pending" value="pending"
               [checked]="taskService.filter() === 'pending'" (change)="onFilterChange('pending')">
        <label class="btn btn-outline-info" for="pending">
          â° Pendentes ({{ taskService.pendingTasks.length }})
        </label>
        
        <input type="radio" class="btn-check" name="filter" id="completed" value="completed"
               [checked]="taskService.filter() === 'completed'" (change)="onFilterChange('completed')">
        <label class="btn btn-outline-secondary" for="completed">
          âœ… ConcluÃ­das ({{ taskService.completedTasks.length }})
        </label>
      </div>

      @if (taskService.loading()) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
          <p class="mt-2">Carregando tarefas...</p>
        </div>
      } @else if (taskService.error()) {
        <div class="alert alert-danger text-center" role="alert">
          <h4 class="alert-heading">âš ï¸ Erro!</h4>
          <p>{{ taskService.error() }}</p>
          <button class="btn btn-primary" (click)="taskService.loadTasks()">
            ğŸ”„ Tentar Novamente
          </button>
        </div>
      } @else {
        @if (taskService.filteredTasks().length === 0) {
          <div class="text-center py-5">
            @if (taskService.totalTasks === 0) {
              <!-- Primeira vez / Lista completamente vazia -->
              <h3>ğŸš€ Comece criando sua primeira tarefa!</h3>
              <p class="text-muted">Organize suas atividades de forma simples e eficiente</p>
            } @else {
              <!-- Filtro sem resultados -->
              <h3>ğŸ” Nenhuma tarefa {{ currentFilterLabel.toLowerCase() }}</h3>
              <p class="text-muted">Tente outro filtro ou crie uma nova tarefa</p>
            }
            <a class="btn btn-primary mt-2" routerLink="/tarefas/nova">
              â• {{ taskService.totalTasks === 0 ? 'Criar Primeira Tarefa' : 'Nova Tarefa' }}
            </a>
          </div>
        } @else {
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-dark">
                <tr>
                  <th scope="col">Status</th>
                  <th scope="col">TÃ­tulo</th>
                  <th scope="col">DescriÃ§Ã£o</th>
                  <th scope="col">Vencimento</th>
                  <th scope="col">Prioridade</th>
                  <th scope="col">AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody>
                @for (task of taskService.filteredTasks(); track task.id) {
                  <tr [class.table-success]="task.completed">
                    <td>
                      <div class="form-check">
                        <input 
                          class="form-check-input" 
                          type="checkbox" 
                          [checked]="task.completed"
                          [disabled]="isUpdating(task.id) || taskService.loading()"
                          (change)="toggleCompleted(task)"
                          [id]="'task-' + task.id">
                        <label class="form-check-label" [for]="'task-' + task.id">
                          {{ task.completed ? 'âœ…' : 'â³' }}
                        </label>
                      </div>
                    </td>
                    <td>
                      <span [class.text-decoration-line-through]="task.completed" 
                            [class.text-muted]="task.completed">
                        {{ task.title }}
                      </span>
                    </td>
                    <td>
                      <span [class.text-decoration-line-through]="task.completed" 
                            [class.text-muted]="task.completed">
                        {{ task.description || '-' }}
                      </span>
                    </td>
                    <td>{{ formatDate(task.dueDate) }}</td>
                    <td>
                      <span class="badge" [class]="getPriority(task.priority).class">
                        {{ getPriority(task.priority).label }}
                      </span>
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm" role="group">
                        <a 
                          class="btn btn-outline-primary" 
                          [routerLink]="['/tarefas/editar', task.id]"
                          title="Editar">
                          âœï¸
                        </a>
                        <button 
                          class="btn btn-outline-danger" 
                          (click)="deleteTask(task)"
                          title="Excluir">
                          ğŸ—‘ï¸
                        </button>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      }
    </div>
  </div>
</div>
